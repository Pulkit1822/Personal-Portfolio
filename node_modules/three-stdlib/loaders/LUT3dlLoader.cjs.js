"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");class t extends e.Loader{load(t,r,a,i){const n=new e.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("text"),n.load(t,(e=>{try{r(this.parse(e))}catch(e){i?i(e):console.error(e),this.manager.itemError(t)}}),a,i)}parse(t){const r=(t=t.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim()).split(/[\n\r]+/g),a=r[0].trim().split(/\s+/g).map((e=>parseFloat(e))),i=a[1]-a[0],n=a.length;for(let e=1,t=a.length;e<t;e++)if(i!==a[e]-a[e-1])throw new Error("LUT3dlLoader: Inconsistent grid size not supported.");const p=new Array(n*n*n*4);let o=0,s=0;for(let e=1,t=r.length;e<t;e++){const t=r[e].trim().split(/\s/g),a=parseFloat(t[0]),i=parseFloat(t[1]),l=parseFloat(t[2]);s=Math.max(s,a,i,l);const g=o%n*n*n+Math.floor(o/n)%n*n+Math.floor(o/(n*n))%n;p[4*g+0]=a,p[4*g+1]=i,p[4*g+2]=l,p[4*g+3]=1,o+=1}const l=Math.ceil(Math.log2(s)),g=Math.pow(2,l);for(let e=0,t=p.length;e<t;e+=4){const t=p[e+0],r=p[e+1],a=p[e+2];p[e+0]=255*t/g,p[e+1]=255*r/g,p[e+2]=255*a/g}const m=new Uint8Array(p),d=new e.DataTexture;d.image.data=m,d.image.width=n,d.image.height=n*n,d.format=e.RGBAFormat,d.type=e.UnsignedByteType,d.magFilter=e.LinearFilter,d.minFilter=e.LinearFilter,d.wrapS=e.ClampToEdgeWrapping,d.wrapT=e.ClampToEdgeWrapping,d.generateMipmaps=!1,d.needsUpdate=!0;const h=new e.Data3DTexture;return h.image.data=m,h.image.width=n,h.image.height=n,h.image.depth=n,h.format=e.RGBAFormat,h.type=e.UnsignedByteType,h.magFilter=e.LinearFilter,h.minFilter=e.LinearFilter,h.wrapS=e.ClampToEdgeWrapping,h.wrapT=e.ClampToEdgeWrapping,h.wrapR=e.ClampToEdgeWrapping,h.generateMipmaps=!1,h.needsUpdate=!0,{size:n,texture:d,texture3D:h}}}exports.LUT3dlLoader=t;
