"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),r=require("react"),t=require("@react-three/fiber"),u=require("react-merge-refs"),n=require("./useFBO.cjs.js");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var u=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,u.get?u:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("three");var s=a(e),l=c(r),f=a(u);const i=l.forwardRef((({envMap:e,resolution:r=256,frames:u=1/0,makeDefault:a,children:c,...i},o)=>{const d=t.useThree((({set:e})=>e)),b=t.useThree((({camera:e})=>e)),m=t.useThree((({size:e})=>e)),p=l.useRef(null),g=l.useRef(null),h=n.useFBO(r);l.useLayoutEffect((()=>{i.manual||(p.current.aspect=m.width/m.height)}),[m,i]),l.useLayoutEffect((()=>{p.current.updateProjectionMatrix()}));let j=0,v=null;const y="function"==typeof c;return t.useFrame((r=>{y&&(u===1/0||j<u)&&(g.current.visible=!1,r.gl.setRenderTarget(h),v=r.scene.background,e&&(r.scene.background=e),r.gl.render(r.scene,p.current),r.scene.background=v,r.gl.setRenderTarget(null),g.current.visible=!0,j++)})),l.useLayoutEffect((()=>{if(a){const e=b;return d((()=>({camera:p.current}))),()=>d((()=>({camera:e})))}}),[p,a,d]),l.createElement(l.Fragment,null,l.createElement("perspectiveCamera",s.default({ref:f.default([p,o])},i),!y&&c),l.createElement("group",{ref:g},y&&c(h.texture)))}));exports.PerspectiveCamera=i;
